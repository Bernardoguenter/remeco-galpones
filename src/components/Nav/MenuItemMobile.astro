---
import ArrowDropDown from "@assets/svg/ArrowDropDown.astro";

interface Props {
  link: string;
  label: string;
  isSubMenu?: boolean;
  styles?: string;
}

const { link, label, isSubMenu = false, styles = "" } = Astro.props;
---

<li
  class={`uppercase text-slate-800 flex items-center relative ${styles} border-b border-b-stone-200 w-full`}
  id={isSubMenu ? `${label.toLowerCase()}-item` : ""}>
  <a
    title={label}
    href={link}
    class="text-stone-200 md:text-slate-800 text-right w-full">
    {label}
  </a>
  {
    isSubMenu && (
      <span id={`${label.toLowerCase()}-arrow`}>
        <ArrowDropDown color="white" />
      </span>
    )
  }
</li>

<script>
  function manageMobileDropdown() {
    const arrowBtn = document.getElementById(`silos-arrow`);
    const dropdown = document.getElementById(`silos-dropdown`);

    if (arrowBtn && dropdown && window.innerWidth < 1024) {
      let isOpen = false;

      arrowBtn.addEventListener("click", (e) => {
        e.stopPropagation();

        if (!isOpen) {
          dropdown.classList.remove("hidden");
          dropdown.classList.add("flex");
          arrowBtn.classList.add("rotate-180");
          isOpen = true;
        } else {
          dropdown.classList.add("hidden");
          dropdown.classList.remove("flex");
          arrowBtn.classList.remove("rotate-180");
          isOpen = false;
        }
      });

      document.addEventListener("click", (e) => {
        if (
          isOpen &&
          !dropdown.contains(e.target as Node) &&
          e.target !== arrowBtn
        ) {
          dropdown.classList.add("hidden");
          dropdown.classList.remove("flex");
          arrowBtn.classList.remove("rotate-180");
          isOpen = false;
        }
      });
    }
  }
  document.addEventListener("astro:page-load", manageMobileDropdown);
  document.addEventListener("astro:before-preparation", manageMobileDropdown);
</script>
